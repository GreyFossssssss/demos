"use strict";var _createClass=function(){function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Gobang=function(){function t(e){_classCallCheck(this,t),this.options=e,this.chessboard=document.getElementById(e.canvas||"chess"),this.result=document.getElementById("result"),this.init(),this.lattice={width:e.gobangStyle.padding,height:e.gobangStyle.padding}}return _createClass(t,[{key:"init",value:function(){var e=this.options;this.role=e.role||1,this.win=!1,this.history=[],this.currentStep=0,this.result.innerText="",this.drawChessBoard(),this.listenDownChessman(),this.initChessboardMatrix()}},{key:"drawChessBoard",value:function(){var e=this.options,t=this.chessboard.getContext("2d"),o=e.gobangStyle,r=o.count,s=o.padding,i=o.borderColor;this.chessboard.width=this.chessboard.height=s*r,t.strokeStyle=i;for(var n=0;n<r;n++)t.moveTo(15+n*s,15),t.lineTo(15+n*s,r*s-15),t.stroke(),t.moveTo(15,15+n*s),t.lineTo(r*s-15,15+n*s),t.stroke()}},{key:"initChessboardMatrix",value:function(){for(var e=this.options,t=[],o=0;o<e.gobangStyle.count;o++){t[o]=[];for(var r=0;r<e.gobangStyle.count;r++)t[o][r]=0}this.checkerboard=t}},{key:"checkReferee",value:function(s,i,e){if(null!=s&&null!=i&&null!=e){var t=0,o=this.checkerboard.map(function(e){return e[i]}),r=this.checkerboard[s],n=[],a=[];if(this.checkerboard.forEach(function(e,t){var o=e[i-(s-t)];void 0!==o&&n.push(o);var r=e[i+(s-t)];void 0!==r&&a.push(r)}),[o,r,n,a].forEach(function(o){o.some(function(e,t){return 0!==o[t]&&o[t-2]===o[t-1]&&o[t-1]===o[t]&&o[t]===o[t+1]&&o[t+1]===o[t+2]})&&t++}),t){this.win=!0;var h=(1==e?"黑":"白")+"子胜利✌️";this.result.innerText=h,this.chessboard.onclick=null}}}},{key:"drawChessman",value:function(e,t,o){var r=this,s=this.chessboard.getContext("2d");s.beginPath(),s.arc(15+30*e,15+30*t,13,0,2*Math.PI),s.closePath();var i=s.createRadialGradient(15+30*e+2,15+30*t-2,13,15+30*e+2,15+30*t-2,0);o?(i.addColorStop(0,"#0a0a0a"),i.addColorStop(1,"#636766")):(i.addColorStop(0,"#d1d1d1"),i.addColorStop(1,"#f9f9f9")),s.fillStyle=i,s.fill(),setTimeout(function(){r.checkReferee(e,t,o?1:2)},0)}},{key:"listenDownChessman",value:function(){var r=this;console.log("落子"),this.chessboard.onclick=function(e){var t=e.offsetX,o=e.offsetY;t=Math.round((t-15)/r.lattice.width),o=Math.round((o-15)/r.lattice.height),void 0!==r.checkerboard[t][o]&&Object.is(r.checkerboard[t][o],0)&&(r.checkerboard[t][o]=r.role,r.drawChessman(t,o,Object.is(r.role,1)),r.history.length=r.currentStep,r.history.push({x:t,y:o,role:r.role}),r.currentStep++,r.role=Object.is(r.role,1)?2:1)}}},{key:"regretChess",value:function(){if(this.history.length&&!this.win){var e=this.history[this.currentStep-1];if(e){var t=e.x,o=e.y;e.role;this.minusStep(t,o),this.checkerboard[e.x][e.y]=0,this.currentStep--,this.role=Object.is(this.role,1)?2:1}}}},{key:"revokedRegretChess",value:function(){var e=this.history[this.currentStep];e&&(this.drawChessman(e.x,e.y,1===e.role),this.checkerboard[e.x][e.y]=e.role,this.currentStep++,this.role=Object.is(this.role,1)?2:1)}},{key:"minusStep",value:function(e,t){var o=this.options.gobangStyle.count;this.chessboard.getContext("2d").clearRect(30*e,30*t,30,30),e<=0&&t<=0?this.fixchessboard(15,15,15,30,15,15,30,15):o-1<=e&&t<=0?this.fixchessboard(30*o-15,15,30*o-30,15,30*o-15,15,30*o-15,30):o-1<=t&&e<=0?this.fixchessboard(15,30*o-15,15,30*o-30,15,30*o-15,30,30*o-15):o-1<=e&&o-1<=t?this.fixchessboard(30*o-15,30*o-15,30*o-30,30*o-15,30*o-15,30*o-15,30*o-15,30*o-30):e<=0&&0<t&&t<o-1?this.fixchessboard(15,30*t+15,30,30*t+15,15,30*t,15,30*t+30):t<=0&&0<e&&e<o-1?this.fixchessboard(30*e+15,15,30*e+15,30,30*e,15,30*e+30,15):o-1<=e&&0<t&&t<o-1?this.fixchessboard(30*o-15,30*t+15,30*o-30,30*t+15,30*o-15,30*t,30*o-15,30*t+30):o-1<=t&&0<e&&e<o-1?this.fixchessboard(30*e+15,30*o-15,30*e+15,30*o-30,30*e,30*o-15,30*e+30,30*o-15):this.fixchessboard(15+30*e,30*t,15+30*e,30*t+30,30*e,30*t+15,30*(e+1),30*t+15)}},{key:"fixchessboard",value:function(e,t,o,r,s,i,n,a){var h=this.chessboard.getContext("2d");h.beginPath(),h.moveTo(e,t),h.lineTo(o,r),h.moveTo(s,i),h.lineTo(n,a),h.stroke()}}]),t}(),gobangGame=new Gobang({canvas:"chess",role:2,gobangStyle:{padding:30,count:20,borderColor:"#bfbfbf"}}),goback=document.getElementById("goback");goback.onclick=function(){gobangGame.regretChess()};var regret=document.getElementById("regret");regret.onclick=function(){gobangGame.revokedRegretChess()};var restart=document.getElementById("restart");restart.onclick=function(){gobangGame.init()};
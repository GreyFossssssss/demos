"use strict";var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Gobang=function(){function e(t){_classCallCheck(this,e),this.options=t,this.chessboard=document.getElementById(t.canvas||"chess"),this.result=document.getElementById("result"),this.init(),this.lattice={width:t.gobangStyle.padding,height:t.gobangStyle.padding}}return _createClass(e,[{key:"init",value:function(){var e=this.options;this.role=e.role||1,this.win=!1,this.history=[],this.currentStep=0,this.result.innerText="",this.drawChessBoard(),this.listenDownChessman(),this.initChessboardMatrix()}},{key:"drawChessBoard",value:function(){var e=this.options,t=this.chessboard.getContext("2d"),o=e.gobangStyle,r=o.count,s=o.padding,i=o.borderColor;this.chessboard.width=this.chessboard.height=s*r,t.strokeStyle=i;for(var n=0;n<r;n++)t.moveTo(15+n*s,15),t.lineTo(15+n*s,r*s-15),t.stroke(),t.moveTo(15,15+n*s),t.lineTo(r*s-15,15+n*s),t.stroke()}},{key:"initChessboardMatrix",value:function(){for(var e=this.options,t=[],o=0;o<e.gobangStyle.count;o++){t[o]=[];for(var r=0;r<e.gobangStyle.count;r++)t[o][r]=0}this.checkerboard=t}},{key:"checkReferee",value:function(e,t,o){if(null!=e&&null!=t&&null!=o){var r=0,s=this.checkerboard.map(function(e){return e[t]}),i=this.checkerboard[e],n=[],a=[];if(this.checkerboard.forEach(function(o,r){var s=o[t-(e-r)];void 0!==s&&n.push(s);var i=o[t+(e-r)];void 0!==i&&a.push(i)}),[s,i,n,a].forEach(function(e){e.some(function(t,o){return 0!==e[o]&&e[o-2]===e[o-1]&&e[o-1]===e[o]&&e[o]===e[o+1]&&e[o+1]===e[o+2]})&&r++}),r){this.win=!0;var h=(1==o?"黑":"白")+"子胜利✌️";this.result.innerText=h,this.chessboard.onclick=null}}}},{key:"drawChessman",value:function(e,t,o){var r=this,s=this.chessboard.getContext("2d");s.beginPath(),s.arc(15+30*e,15+30*t,13,0,2*Math.PI),s.closePath();var i=s.createRadialGradient(15+30*e+2,15+30*t-2,13,15+30*e+2,15+30*t-2,0);o?(i.addColorStop(0,"#0a0a0a"),i.addColorStop(1,"#636766")):(i.addColorStop(0,"#d1d1d1"),i.addColorStop(1,"#f9f9f9")),s.fillStyle=i,s.fill(),setTimeout(function(){r.checkReferee(e,t,o?1:2)},0)}},{key:"listenDownChessman",value:function(){var e=this;console.log("落子"),this.chessboard.onclick=function(t){var o=t.offsetX,r=t.offsetY;o=Math.round((o-15)/e.lattice.width),r=Math.round((r-15)/e.lattice.height),void 0!==e.checkerboard[o][r]&&Object.is(e.checkerboard[o][r],0)&&(e.checkerboard[o][r]=e.role,e.drawChessman(o,r,Object.is(e.role,1)),e.history.length=e.currentStep,e.history.push({x:o,y:r,role:e.role}),e.currentStep++,e.role=Object.is(e.role,1)?2:1)}}},{key:"regretChess",value:function(){if(this.history.length&&!this.win){var e=this.history[this.currentStep-1];if(e){var t=e.x,o=e.y;e.role;this.minusStep(t,o),this.checkerboard[e.x][e.y]=0,this.currentStep--,this.role=Object.is(this.role,1)?2:1}}}},{key:"revokedRegretChess",value:function(){var e=this.history[this.currentStep];e&&(this.drawChessman(e.x,e.y,1===e.role),this.checkerboard[e.x][e.y]=e.role,this.currentStep++,this.role=Object.is(this.role,1)?2:1)}},{key:"minusStep",value:function(e,t){var o=this.options.gobangStyle.count;this.chessboard.getContext("2d").clearRect(30*e,30*t,30,30),e<=0&&t<=0?this.fixchessboard(15,15,15,30,15,15,30,15):e>=o-1&&t<=0?this.fixchessboard(30*o-15,15,30*o-30,15,30*o-15,15,30*o-15,30):t>=o-1&&e<=0?this.fixchessboard(15,30*o-15,15,30*o-30,15,30*o-15,30,30*o-15):e>=o-1&&t>=o-1?this.fixchessboard(30*o-15,30*o-15,30*o-30,30*o-15,30*o-15,30*o-15,30*o-15,30*o-30):e<=0&&t>0&&t<o-1?this.fixchessboard(15,30*t+15,30,30*t+15,15,30*t,15,30*t+30):t<=0&&e>0&&e<o-1?this.fixchessboard(30*e+15,15,30*e+15,30,30*e,15,30*e+30,15):e>=o-1&&t>0&&t<o-1?this.fixchessboard(30*o-15,30*t+15,30*o-30,30*t+15,30*o-15,30*t,30*o-15,30*t+30):t>=o-1&&e>0&&e<o-1?this.fixchessboard(30*e+15,30*o-15,30*e+15,30*o-30,30*e,30*o-15,30*e+30,30*o-15):this.fixchessboard(15+30*e,30*t,15+30*e,30*t+30,30*e,30*t+15,30*(e+1),30*t+15)}},{key:"fixchessboard",value:function(e,t,o,r,s,i,n,a){var h=this.chessboard.getContext("2d");h.beginPath(),h.moveTo(e,t),h.lineTo(o,r),h.moveTo(s,i),h.lineTo(n,a),h.stroke()}}]),e}(),gobangGame=new Gobang({canvas:"chess",role:2,gobangStyle:{padding:30,count:20,borderColor:"#bfbfbf"}}),goback=document.getElementById("goback");goback.onclick=function(){gobangGame.regretChess()};var regret=document.getElementById("regret");regret.onclick=function(){gobangGame.revokedRegretChess()};var restart=document.getElementById("restart");restart.onclick=function(){gobangGame.init()};